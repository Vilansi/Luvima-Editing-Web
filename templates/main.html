<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luvima - Advanced Image Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>

<body>
    <!-- Loading Overlay -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="navbar-toggle" onclick="toggleNavbar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Navbar -->
    <nav class="navbar" id="navbar">
        <div class="navbar-brand">
            <h2>Luvima</h2>
            <p>Welcome, {{ username }}!</p>
        </div>
        <div class="navbar-links">
            <a href="{{ url_for('login') }}">Home</a>
            <a href="{{ url_for('home') }}">About</a>
            <a href="/logout">Logout</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="container disable" id="container">
            <div class="wrapper">
                <div class="editor-panel">

                    <!-- Filters Section -->
                    <div class="editor-section">
                        <div class="section-title"><i class="fas fa-sliders-h"></i> Filters</div>
                        <div class="filter-options">
                            <button class="filter-btn active" data-filter="brightness"><i class="fas fa-sun"></i> Brightness</button>
                            <button class="filter-btn" data-filter="saturation"><i class="fas fa-palette"></i> Saturation</button>
                            <button class="filter-btn" data-filter="inversion"><i class="fas fa-adjust"></i> Inversion</button>
                            <button class="filter-btn" data-filter="grayscale"><i class="fas fa-circle"></i> Grayscale</button>
                            <button class="filter-btn" data-filter="blur"><i class="fas fa-eye-slash"></i> Blur</button>
                            <button class="filter-btn" data-filter="contrast"><i class="fas fa-circle-half-stroke"></i> Contrast</button>
                            <button class="filter-btn" data-filter="opacity"><i class="fas fa-low-vision"></i> Opacity</button>
                            <button class="filter-btn" data-filter="sepia"><i class="fas fa-coffee"></i> Sepia</button>
                            <button class="filter-btn" data-filter="sharpen"><i class="fas fa-crosshairs"></i> Sharpen</button>
                            <button class="filter-btn" data-filter="border-radius"><i class="fas fa-border-style"></i> Border Radius</button>
                        </div>
                        <div class="slider-container">
                            <div class="slider-info">
                                <span class="filter-name">Brightness</span>
                                <span class="value">100%</span>
                            </div>
                            <input type="range" class="slider" id="filterSlider" value="100" min="0" max="200">
                        </div>
                    </div>

                    <!-- Rotate, Flip, and Crop -->
                    <div class="editor-section">
                        <div class="section-title"><i class="fas fa-redo"></i> Rotate & Flip</div>
                        <div class="rotate-options">
                            <button class="rotate-btn" data-action="rotate-left"><i class="fas fa-undo"></i></button>
                            <button class="rotate-btn" data-action="rotate-right"><i class="fas fa-redo"></i></button>
                            <button class="rotate-btn" data-action="flip-horizontal"><i class="fas fa-arrows-alt-h"></i></button>
                            <button class="rotate-btn" data-action="flip-vertical"><i class="fas fa-arrows-alt-v"></i></button>
                        </div>
                    </div>

                    <div class="editor-section">
                        <div class="section-title"><i class="fas fa-crop-alt"></i> Crop</div>
                        <button class="filter-btn" id="cropBtn"><i class="fas fa-crop"></i> Crop Image</button>
                    </div>

                    <!-- Background Colors Section -->
                    <div class="editor-section">
                            <button type="submit">Remove Background</button>

                        <div class="section-title"><i class="fas fa-palette"></i> Background Colors</div>
                        <div class="background-options" id="backgroundOptions">
                            <div class="bg-thumb" data-bg="#ffffff" style="background-color: #e81616;"></div>
                            <div class="bg-thumb" data-bg="#f8f9fa" style="background-color: #465667;"></div>
                            <div class="bg-thumb" data-bg="#ffadad" style="background-color: #ffadad;"></div>
                            <div class="bg-thumb" data-bg="#ffd6a5" style="background-color: #eb9f43;"></div>
                            <div class="bg-thumb" data-bg="#caffbf" style="background-color: #59de3f;"></div>
                            <div class="bg-thumb" data-bg="#9bf6ff" style="background-color: #35deed;"></div>
                            <div class="bg-thumb" data-bg="#bdb2ff" style="background-color: #6758be;"></div>
                            <div class="bg-thumb" data-bg="#ffc6ff" style="background-color: #d625d6;"></div>
                        </div>
                    </div>

                </div>

                <!-- Preview Area -->
                <div class="preview-area">
                    <div class="upload-placeholder" id="uploadPlaceholder">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Upload Your Image</h3>
                        <a href="#" id="chooseImageLink">Choose an image to start editing</a>
                    </div>

                    <canvas id="imageCanvas" style="display:none;"></canvas>
                    <img class="preview-img" id="previewImg" alt="Preview" style="display: none;">

                    <!-- Hidden file input -->
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                </div>

            </div>

            <!-- Controls -->
            <div class="controls">
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="control-btn btn-reset" id="resetBtn"><i class="fas fa-undo"></i> Reset</button>
                    <input type="file" class="file-input" id="fileInput" accept="image/*">
                    <button class="control-btn btn-choose" id="chooseBtn"><i class="fas fa-folder-open"></i> Choose Image</button>
                    <div class="dropdown">
                        <button class="control-btn btn-save" id="saveBtn"><i class="fas fa-download"></i> Save</button>
                    </div>
                    <label class="aspect-ratio-option">
                        <input type="checkbox" id="aspectRatioLock"> Lock Aspect Ratio
                    </label>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='main.js') }}">document.getElementById('removeBgForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const fileInput = document.getElementById('bgImage');
    const colorInput = document.getElementById('bgColor');
    const formData = new FormData();
    formData.append('image', fileInput.files[0]);
    formData.append('bgcolor', colorInput.value);

    const res = await fetch('/remove_bg_color_ajax', {
        method: 'POST',
        body: formData
    });

    const data = await res.json();
    if(data.result_image){
        const canvas = document.getElementById('bgCanvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.src = data.result_image;
        img.onload = () => {
            canvas.style.display = 'block';
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.fillStyle = colorInput.value;
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.drawImage(img,0,0);
            const downloadLink = document.getElementById('downloadBg');
            downloadLink.href = data.result_image;
            downloadLink.style.display = 'inline-block';
        };
    }
});</script>
</body>

</html>
